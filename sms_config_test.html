<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>onbukaçŸ­ä¿¡APIæµ‹è¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #667eea; color: white; padding: 10px 30px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #5568d3; }
        .result { margin-top: 20px; padding: 15px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>onbuka.com çŸ­ä¿¡APIæµ‹è¯•å·¥å…·</h1>
    
    <div class="info result">
        <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
        1. ä» onbuka.com åå°è·å–çœŸå®çš„ App IDã€API Keyã€API Secret<br>
        2. å¡«å…¥ä¸‹é¢çš„è¡¨å•<br>
        3. ç‚¹å‡»"æµ‹è¯•API"æŸ¥çœ‹ç»“æœ<br>
        4. å¦‚æœæˆåŠŸï¼Œå°†é…ç½®æ›´æ–°åˆ° sms.php æ–‡ä»¶
    </div>
    
    <form id="testForm">
        <div class="form-group">
            <label>App ID (åº”ç”¨ID):</label>
            <input type="text" id="appId" value="cs_2fii8n" placeholder="è¯·è¾“å…¥æ‚¨çš„App ID">
        </div>
        
        <div class="form-group">
            <label>API Key (APIå¯†é’¥):</label>
            <input type="text" id="apiKey" value="JN85gvcv" placeholder="è¯·è¾“å…¥æ‚¨çš„API Key">
        </div>
        
        <div class="form-group">
            <label>API Secret (å¯†é’¥):</label>
            <input type="text" id="apiSecret" value="KJ1kPhA7" placeholder="è¯·è¾“å…¥æ‚¨çš„API Secret">
        </div>
        
        <div class="form-group">
            <label>æµ‹è¯•æ‰‹æœºå·:</label>
            <input type="text" id="mobile" value="8613800138000" placeholder="ä¾‹: 8613800138000">
        </div>
        
        <div class="form-group">
            <label>çŸ­ä¿¡å†…å®¹:</label>
            <input type="text" id="content" value="Test message from API" placeholder="æµ‹è¯•å†…å®¹">
        </div>
        
        <button type="submit">æµ‹è¯• API</button>
    </form>
    
    <div id="result"></div>
    
    <script src="/Public/Home/static/js/jquery-3.3.1.min.js"></script>
    <script>
    $('#testForm').submit(function(e) {
        e.preventDefault();
        
        var appId = $('#appId').val();
        var apiKey = $('#apiKey').val();
        var apiSecret = $('#apiSecret').val();
        var mobile = $('#mobile').val();
        var content = $('#content').val();
        
        if (!appId || !apiKey || !apiSecret || !mobile) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹');
            return;
        }
        
        $('#result').html('<div class="info result">æ­£åœ¨æµ‹è¯•...</div>');
        
        // ç”Ÿæˆç­¾å
        var timestamp = Math.floor(Date.now() / 1000);
        var signStr = apiKey + apiSecret + timestamp;
        
        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        var debug = '=== è°ƒè¯•ä¿¡æ¯ ===\n';
        debug += 'App ID: ' + appId + '\n';
        debug += 'API Key: ' + apiKey + '\n';
        debug += 'API Secret: ' + apiSecret.substring(0, 4) + '****\n';
        debug += 'Timestamp: ' + timestamp + '\n';
        debug += 'ç­¾åå­—ç¬¦ä¸²: ' + signStr + '\n\n';
        
        // è°ƒç”¨åç«¯æµ‹è¯•æ¥å£
        $.ajax({
            url: '/test_sms_direct.php',
            method: 'POST',
            data: {
                appId: appId,
                apiKey: apiKey,
                apiSecret: apiSecret,
                mobile: mobile,
                content: content,
                timestamp: timestamp
            },
            success: function(response) {
                try {
                    var result = typeof response === 'string' ? JSON.parse(response) : response;
                    
                    var html = '<div class="result ';
                    if (result.status == '-1') {
                        html += 'error">âŒ è®¤è¯å¤±è´¥\n\n';
                        html += debug;
                        html += 'é”™è¯¯: ' + result.reason + '\n\n';
                        html += 'âš ï¸ è¯·æ£€æŸ¥:\n';
                        html += '1. App ID æ˜¯å¦æ­£ç¡®ï¼ˆæœ€å¸¸è§é—®é¢˜ï¼‰\n';
                        html += '2. API Key æ˜¯å¦æ­£ç¡®\n';
                        html += '3. API Secret æ˜¯å¦æ­£ç¡®\n';
                        html += '4. è´¦å·æ˜¯å¦å·²æ¿€æ´»\n';
                    } else if (result.status == '0' || result.status == '1') {
                        html += 'success">âœ… æµ‹è¯•æˆåŠŸï¼\n\n';
                        html += debug;
                        html += 'å®Œæ•´å“åº”:\n' + JSON.stringify(result, null, 2) + '\n\n';
                        html += 'ğŸ“ ä¸‹ä¸€æ­¥:\n';
                        html += 'è¯·æ›´æ–°é…ç½®æ–‡ä»¶ Application/Common/Conf/sms.php:\n';
                        html += "'SMS_API_KEY' => '" + apiKey + "',\n";
                        html += "'SMS_API_SECRET' => '" + apiSecret + "',\n";
                        html += "'SMS_APP_ID' => '" + appId + "',\n";
                    } else {
                        html += 'info">å“åº”:\n' + JSON.stringify(result, null, 2);
                    }
                    html += '</div>';
                    
                    $('#result').html(html);
                } catch(e) {
                    $('#result').html('<div class="error result">è§£æé”™è¯¯: ' + e.message + '\n\nåŸå§‹å“åº”:\n' + response + '</div>');
                }
            },
            error: function(xhr, status, error) {
                $('#result').html('<div class="error result">è¯·æ±‚å¤±è´¥: ' + error + '</div>');
            }
        });
    });
    </script>
</body>
</html>

