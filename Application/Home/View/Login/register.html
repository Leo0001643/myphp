<!DOCTYPE html>
<html   >
<head>
    <meta charset="UTF-8">
    <title>{$webname}</title>
    <link rel="stylesheet" href="/Public/Home/login/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" type="text/css" href="/Public/Home/static/css/base.css" />

    <link rel="stylesheet" href="/Public/Dela/demo/demo.css">
    <link rel="stylesheet" href="/Public/Dela/template/dela-template.css">
    <link rel="stylesheet" href="/Public/build/css/countrySelect.css">

    <link rel="stylesheet" href="/Public/Home/static/css/style.css">

    <style>
        /* 让输入框标签直接显示，不需要点击 */
        .input-label {
            color: #6658d3 !important;
            transform: translateY(-1.5rem) !important;
        }
        
        .input-field:focus + .input-label, 
        .input-field:valid + .input-label {
            color: #6658d3 !important;
            transform: translateY(-1.5rem) !important;
        }
        
        /* 确保密码输入框的标签也直接显示 */
        #lpwd + .input-label {
            color: #6658d3 !important;
            transform: translateY(-1.5rem) !important;
        }
        
        .main_demo {
            width: 28% !important;
            float: left;
        }

        .container-input {
            padding-left: 0px;
            width: 60%;
            margin: 0px;
        }

        button {
            appearance: auto;
            writing-mode: horizontal-tb !important;
            text-rendering: auto;
            color: buttontext;
            letter-spacing: normal;
            word-spacing: normal;
            line-height: normal;
            text-transform: none;
            text-indent: 0px;
            text-shadow: none;
            display: inline-block;
            text-align: center;
            align-items: flex-start;
            cursor: default;
            box-sizing: border-box;
            background-color: buttonface;
            margin: 0em;
            padding: 1px 6px;
            border-width: 2px;
            border-style: outset;
            border-color: buttonborder;
            border-image: initial;
        }
        .btn-hover {
            width: 7em;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            cursor: pointer;
            height: 30px;
            text-align: center;
            border: none;
            background-size: 300% 100%;
            border-radius: 50px;
            moz-transition: all .4s ease-in-out;
            -o-transition: all .4s ease-in-out;
            -webkit-transition: all .4s ease-in-out;
            transition: all .4s ease-in-out;
        }
        .btn-hover.color-1 {
            /*color: #0052fe;*/
            color: #6d7c82;
            border: none !important;
            /*background-image: linear-gradient(to right, #25aae1, #40e495, #30dd8a, #2bb673);*/
            /*box-shadow: 0 4px 15px 0 rgb(49 196 190 / 75%);*/
        }
        .btn-hover.color-6 {
            /*color: #0052fe;*/
            color: #6d7c82;
            border: none !important;
            /*background-image: linear-gradient(to right, #009245, #FCEE21, #00A8C5, #D9E021);*/
            /*box-shadow: 0 4px 15px 0 rgb(83 176 57 / 75%);*/
        }
        .btnl {
            float: left;
 

        }
        .btnr {
            float: right;
            margin-bottom:1.1em;
            position: absolute;
            left: 40%;
        }
        .code {
            width: 100% !important;
        }
        .send-btn {
            width: 20%;
            height: 1.8em;
            position: absolute;
            top: 415px;
            left: 220px;
        }
        .mobile_input {
            width: 70% !important;
            float: right;
        }
        
        /* 验证码按钮自适应样式 */
        #getCodeBtn {
            transition: all 0.3s ease;
        }
        
        #getCodeBtn:hover {
            background-color: rgba(255,255,255,0.7) !important;
        }
        
        #getCodeLabel {
            transition: all 0.3s ease;
        }

        .btn-hover.color-4 {
            background-image: linear-gradient(to right, #fc6076, #ff9a44, #ef9d43, #e75516);
            box-shadow: 0 4px 15px 0 rgb(252 104 110 / 75%);
        }

        .css-jmskxt {
            background: #000000;
        }

        .country-name {
            color: #000;
        }

    </style>
</head>
<body>
<include file="Public:header"/>



<!-- partial:index.partial.html -->
<div class="starfield">
    <div class="static"></div>
    <div class="moving-1"></div>
    <div class="moving-2"></div>
    <div class="moving-3"></div>
</div>

<!-- partial -->





<!-- partial:index.partial.html -->
<div class="container">
    <!-- code here -->
    <div class="card">
        <form class="card-form" onClick="return false">
            <div class="margin-topbox-px-10">
                <div data-bn-type="text" class="css-1g5tc38  tcl fch f36 fw">{:L('立即注册')}<span class="floginbr"> {:get_config('webname')}</span></div>
                <div data-bn-type="text" class="css-152kxht tcl f16"></div>
            </div>

            <div class="input">
                <button class="btn-hover color-6 btnr" onClick="stype(2)">E-mail</button>
                <button class="btn-hover color-1 btnl" onClick="stype(1)">Mobile</button>
            </div>

            <input type="hidden" name="type" id="type" value="1">
            <input type="hidden" name="account" id="account" >
            <div class="input"  id="e-box" style="display: none">
                <input type="text" class="input-field" name="email" id="email" value=""  required/>
                <label class="input-label">{:L('邮箱')}</label>
            </div>

            <div id="main_demo" style="margin-bottom:1.1em;display: block" >
                <div class="container input container-input">
                    <div class="form-item">
                        <input id="country_selector" style="width: 367px;border-bottom: 1px solid #eee;" class="input-field"  type="text">
                        <label for="country_selector" style="display:none;">Select a country here...</label>
                    </div>
                    <button type="submit" style="display:none;">Submit</button>
                </div>
            </div>


            <div class="input" style="margin-top: 1.5rem;">
                <input type="password" class="input-field"  name="lpwd" id="lpwd" value="" required/>
                <label class="input-label">{:L('密码')}</label>
            </div>

            <div class="input">
                <input type="text" class="input-field"  name="invit" id="invit" value="{$qrcode}" required/>
                <label class="input-label">{:L('邀请码')}</label>
            </div>

            <div class="input">
                <input type="text" class="input-field"  name="ecode" id="ecode" value="" style="width: 70%" required />
                <label class="input-label">{:L('验证码')}</label>
                <div class="action-button login-send-button tcc" id="sendCodeBtn" onclick="sendVerifyCode()" style="background-color: rgba(255,255,255,0.5);width: 30%;line-height: 38px;cursor: pointer;">
                    <a><label class="" style="margin: 0px;color: #fff" id="sendCodeText">{:L('获取验证码')}</label></a>
                </div>
            </div>
            <div class="action">
                <button class="action-button " onClick="upreg()">{:L('立即注册')}</button>
            </div>
        </form>
        <div class="login-reg tcr">
            <a href="{:U('Login/findpwd')}"  class="css-s84t59 fbaseblue" >{:L('忘记密码')}？</a>
            <a href="{:U('Login/index')}"  class="css-utqtyo fbaseblue" >{:L('登录')}</a>
        </div>
    </div>
</div>
<!-- partial -->

</body>


<script src="/Public/Home/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/Public/Home/static/js/layer/layer.js" ></script>
<script type="text/javascript" src="/Public/Home/static/js/jquery.SuperSlide.2.1.1.js" ></script>

<script type="text/javascript">
    // =================== 发送验证码功能 ===================
    var countdown = 0; // 倒计时秒数
    var countdownTimer = null; // 倒计时定时器

    /**
     * 发送验证码
     */
    function sendVerifyCode() {
        // 如果正在倒计时，不允许再次发送
        if (countdown > 0) {
            layer.msg("{:L('请稍后再试')}");
            return false;
        }
        
        var type = $('#type').val();
        
        if (type == 1) { 
            // ========== 手机注册：发送短信验证码 ==========
            var mobile = $("#country_selector").val();
            if (mobile == '' || mobile == null) {
                layer.msg("{:L('请输入手机号')}");
                return false;
            }
            
            // 验证手机号格式（基础验证：必须包含国际区号）
            var parts = mobile.trim().split(' ');
            if (parts.length != 2 || !parts[0].startsWith('+')) {
                layer.msg("{:L('手机号格式错误，格式：+86 13800138000')}");
                return false;
            }
            
            // 显示加载提示
            var loadingIndex = layer.load(1, {shade: [0.3, '#fff']});
            
            // 发送短信验证码
            $.post("{:U('Login/sendMobileSms')}", {
                mobile: mobile,
                type: 2 // 注册类型
            }, function(data) {
                layer.close(loadingIndex);
                
                if (data.code == 1) {
                    layer.msg(data.info);
                    // 调试模式下显示验证码
                    if (data.msg) {
                        console.log('验证码（调试）：' + data.msg);
                    }
                    // 开始60秒倒计时
                    startCountdown(60);
                } else {
                    layer.msg(data.info);
                }
            }).fail(function() {
                layer.close(loadingIndex);
                layer.msg("{:L('网络错误，请稍后重试')}");
            });
            
        } else if (type == 2) { 
            // ========== 邮箱注册：发送邮件验证码 ==========
            var email = $("#email").val();
            if (email == '' || email == null) {
                layer.msg("{:L('请输入邮箱')}");
                return false;
            }
            
            var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
            if (!reg.test(email)) {
                layer.msg("{:L('邮箱格式不正确')}");
                return false;
            }
            
            // 显示加载提示
            var loadingIndex = layer.load(1, {shade: [0.3, '#fff']});
            
            // 发送邮箱验证码（原有逻辑）
            $.post("{:U('Login/getcodesss')}", {
                email: email,
                type: 2
            }, function(data) {
                layer.close(loadingIndex);
                
                if (data.code == 1) {
                    layer.msg(data.info);
                    // 调试模式下显示验证码
                    if (data.msg) {
                        console.log('验证码（调试）：' + data.msg);
                    }
                    startCountdown(60);
                } else {
                    layer.msg(data.info);
                }
            }).fail(function() {
                layer.close(loadingIndex);
                layer.msg("{:L('网络错误，请稍后重试')}");
            });
        } else {
            layer.msg("{:L('请选择注册类型')}");
        }
    }

    /**
     * 开始倒计时
     * @param {int} seconds 倒计时秒数
     */
    function startCountdown(seconds) {
        countdown = seconds;
        $('#sendCodeBtn').css({
            'background-color': '#ccc',
            'cursor': 'not-allowed',
            'opacity': '0.6'
        });
        
        // 更新按钮文字
        $('#sendCodeText').text(countdown + 's');
        
        // 启动定时器
        countdownTimer = setInterval(function() {
            countdown--;
            $('#sendCodeText').text(countdown + 's');
            
            if (countdown <= 0) {
                clearInterval(countdownTimer);
                countdown = 0;
                $('#sendCodeText').text("{:L('获取验证码')}");
                $('#sendCodeBtn').css({
                    'background-color': 'rgba(255,255,255,0.5)',
                    'cursor': 'pointer',
                    'opacity': '1'
                });
            }
        }, 1000);
    }
    
    // =================== 注册提交功能 ===================
    function upreg(){
        var  type = $('#type').val();
        if (type != 1 && type != 2) {
            layer.msg("{:L('请选择注册类型')}");return false;
        }
        // console.log(type);
        // return false;

        if (type == 1) {
            var account = $("#country_selector").val();
            if(account=='' || account == null){
                layer.msg("{:L('请输入密码')}");return false;
            }
        }
        if (type == 2) {
            var email = $("#email").val();
            var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
            if(email=='' || email == null){
                layer.msg("{:L('请输入邮箱')}");return false;
            }
            if(!reg.test(email)){
                layer.msg("{:L('邮箱格式不正确')}");return false;
            }
            var account = email;
        }

        var ecode = $("#ecode").val();
        if(ecode == ''){
            layer.msg("{:L('请输入验证码')}");return false;
        }
        var lpwd = $("#lpwd").val();
        if(lpwd == ''){
            layer.msg("{:L('请输入密码')}");return false;
        }
        var invit = $("#invit").val();
        if( invit == ''){
            layer.msg("{:L('请输入邀请码')}");return false;
        }
        console.log(type)
        console.log(account)
        console.log(ecode)
        console.log(lpwd)
        console.log(invit)

        $.post("{:U('Login/upregister')}",
            {'account' : account, 'ecode' : ecode, 'lpwd' : lpwd, 'invit' : invit, 'type' : type},
            function(data){
                if(data.code == 1){
                    layer.msg(data.info);
                    setTimeout(function(){
                        window.location.href="{:U('Login/index')}";
                    },2000);
                }else{
                    layer.msg(data.info);return false;
                }
            }
        );


    }
</script>


<script type="text/javascript">

    function stype(type) {
       $('.btn-hover').css('color', '#6d7c82')
        if (type == 2) {
            $('#e-box').show();
            $('#main_demo').hide();
            $('.btnr').css('color','#0052fe')

        }
        if (type == 1) {
            $('#e-box').hide();
            $('#main_demo').show();
            $('.btnl').css('color','#0052fe')

        }
        $('#type').val(type);

    }

    function goindex(){
        window.location.href="{:U('Index/index')}";
    }

    function uplogin(){
        window.location.href="{:U('Login/index')}";
    }

    function forgot_password() {
        window.location.href="{:U('Login/findpwd')}";
    }


</script>

<script type="text/javascript">
    $("#nav").slide({
        type:"menu",// 效果类型，针对菜单/导航而引入的参数（默认slide）
        titCell:".nLi", //鼠标触发对象
        targetCell:".sub", //titCell里面包含的要显示/消失的对象
        effect:"slideDown", //targetCell下拉效果
        delayTime:300 , //效果时间
        triggerTime:0, //鼠标延迟触发时间（默认150）
        returnDefault:true //鼠标移走后返回默认状态，例如默认频道是“预告片”，鼠标移走后会返回“预告片”（默认false）
    });
</script>
<script src="/Public/build/js/jquery-1.9.1.min.js"></script>
<script src="/Public/build/js/countrySelect.js"></script>
<script>
    $("#country_selector").countrySelect({
        preferredCountries: ["jp","us"]
    });
</script>

</html>

