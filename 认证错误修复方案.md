# 认证错误修复方案

## 🐛 错误信息
```json
{
  "status": "-1",
  "reason": "Authentication error",
  "success": "0",
  "fail": "0"
}
```

**原因**：API认证失败

---

## 🔍 可能的原因

### 1. App ID错误 ⭐ 最可能

您提供的信息：
- App ID from Demo: `cs_2fii8n`
- 但可能实际的App ID不是这个

**解决**：请登录 onbuka.com 后台确认**真实的 App ID**

### 2. API Secret错误

当前使用：`KJ1kPhA7`

请确认这是否是正确的 API Secret（不是 API Key）

### 3. 签名算法顺序

官方Demo：`md5(apiKey + apiSecret + timestamp)`

可能需要的变体：
- `md5(apiSecret + apiKey + timestamp)`
- `md5(appId + apiSecret + timestamp)`
- `md5(apiKey + timestamp + apiSecret)`

---

## 🔧 立即测试不同的签名方式

我创建了一个测试不同签名算法的脚本：

```php
<?php
// 测试不同的签名组合
$apiKey = "JN85gvcv";
$apiSecret = "KJ1kPhA7";
$appId = "cs_2fii8n";
$timestamp = time();

echo "=== 测试不同签名算法 ===\n\n";

// 算法1：apiKey + apiSecret + timestamp
$sign1 = md5($apiKey . $apiSecret . $timestamp);
echo "算法1: md5(apiKey + apiSecret + timestamp)\n";
echo "拼接: " . $apiKey . $apiSecret . $timestamp . "\n";
echo "签名: " . $sign1 . "\n\n";

// 算法2：apiSecret + apiKey + timestamp
$sign2 = md5($apiSecret . $apiKey . $timestamp);
echo "算法2: md5(apiSecret + apiKey + timestamp)\n";
echo "拼接: " . $apiSecret . $apiKey . $timestamp . "\n";
echo "签名: " . $sign2 . "\n\n";

// 算法3：appId + apiSecret + timestamp
$sign3 = md5($appId . $apiSecret . $timestamp);
echo "算法3: md5(appId + apiSecret + timestamp)\n";
echo "拼接: " . $appId . $apiSecret . $timestamp . "\n";
echo "签名: " . $sign3 . "\n\n";

// 算法4：apiKey + timestamp + apiSecret
$sign4 = md5($apiKey . $timestamp . $apiSecret);
echo "算法4: md5(apiKey + timestamp + apiSecret)\n";
echo "拼接: " . $apiKey . $timestamp . $apiSecret . "\n";
echo "签名: " . $sign4 . "\n\n";

// 逐个测试
function testSign($url, $appId, $mobile, $content, $sign, $timestamp, $apiKey) {
    $dataArr = array(
        'appId' => $appId,
        'numbers' => $mobile,
        'content' => $content,
        'senderId' => '',
        'orderId' => ''
    );
    
    $data = json_encode($dataArr);
    $headers = array(
        'Content-Type: application/json;charset=UTF-8',
        'Sign: ' . $sign,
        'Timestamp: ' . $timestamp,
        'Api-Key: ' . $apiKey
    );
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
    curl_setopt($ch, CURLOPT_TIMEOUT, 10);
    
    $output = curl_exec($ch);
    curl_close($ch);
    
    return json_decode($output, true);
}

$url = "https://api.onbuka.com/v3/sendSms";
$mobile = "8613800138000";
$content = "Test";

// 测试算法1
echo "测试算法1...\n";
$result1 = testSign($url, $appId, $mobile, $content, $sign1, $timestamp, $apiKey);
print_r($result1);
echo "\n";

// 如果算法1失败，测试算法2
if (isset($result1['status']) && $result1['status'] == '-1') {
    echo "算法1失败，测试算法2...\n";
    $result2 = testSign($url, $appId, $mobile, $content, $sign2, $timestamp, $apiKey);
    print_r($result2);
    echo "\n";
}
?>
```

保存为 `test_sign.php`，运行：
```bash
php test_sign.php
```

---

## 🎯 最关键：确认配置信息

### 请在 onbuka.com 后台确认：

1. **App ID** (应用ID)
   - 当前使用：`cs_2fii8n`
   - 请确认是否正确 ⭐

2. **API Key**
   - 当前使用：`JN85gvcv`
   - 请确认是否正确

3. **API Secret**
   - 当前使用：`KJ1kPhA7`
   - 请确认是否正确 ⭐

4. **签名算法**
   - 查看onbuka后台文档
   - 确认签名的拼接顺序

---

## 💡 临时方案

如果App ID、API Key或Secret中任何一个不对，都会导致认证失败。

### 方案A：联系onbuka技术支持

提供您的账号信息，让他们帮忙确认：
- 正确的 App ID
- 正确的 API Secret
- 正确的签名算法

### 方案B：查看onbuka后台文档

登录后台，查找：
- API接入文档
- 签名生成示例
- 接口调试工具（如果有）

---

## ✅ 确认清单

请确认以下信息后告诉我：

```
□ App ID: __________ (从后台确认)
□ API Key: __________ (从后台确认)
□ API Secret: __________ (从后台确认)
□ 签名算法: __________ (从文档确认)
```

有了准确的配置信息，我立即可以修复！

---

**关键提示**：Demo代码中的 `cs_2fii8n` 可能是示例App ID，不是您实际的App ID。请务必从您的onbuka后台获取真实的配置信息。

---

**创建时间**：2026年1月5日  
**状态**：等待确认真实的API配置信息

